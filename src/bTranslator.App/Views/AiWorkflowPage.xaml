<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="bTranslator.App.Views.AiWorkflowPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:viewModels="using:bTranslator.App.ViewModels"
    mc:Ignorable="d">
    <Grid
        Background="{StaticResource VsCodeBackgroundBrush}"
        Padding="16"
        RowSpacing="12">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <Border
            Background="Transparent"
            BorderBrush="{StaticResource VsCodeBorderBrush}"
            BorderThickness="0,0,0,1"
            CornerRadius="0"
            Padding="14,10">
            <Grid RowSpacing="4">
                <TextBlock
                    FontFamily="Segoe UI Variable Display Semibold"
                    FontSize="20"
                    Foreground="{StaticResource VsCodeTextBrush}"
                    Text="AI Workflow Designer" />
                <TextBlock
                    Margin="0,28,0,0"
                    FontFamily="Cascadia Mono"
                    Foreground="{StaticResource VsCodeSubtleTextBrush}"
                    Text="{Binding ProviderChainPreview}" />
            </Grid>
        </Border>

        <Grid
            Grid.Row="1"
            ColumnSpacing="10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="1.8*" />
                <ColumnDefinition Width="1.2*" />
            </Grid.ColumnDefinitions>

            <Border
                Grid.Column="0"
                Style="{StaticResource PanelCardBorderStyle}">
                <Grid RowSpacing="8">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <TextBlock
                        Style="{StaticResource SectionTitleTextStyle}"
                        Text="Provider Chain Builder" />

                    <Grid
                        Grid.Row="1"
                        ColumnSpacing="8">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <ListView
                            ItemsSource="{Binding ProviderOptions}"
                            SelectedItem="{Binding SelectedProviderOption, Mode=TwoWay}">
                            <ListView.ItemTemplate>
                                <DataTemplate x:DataType="viewModels:ProviderChainItemViewModel">
                                    <Grid ColumnSpacing="8">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>
                                        <CheckBox
                                            IsChecked="{Binding IsEnabled, Mode=TwoWay}"
                                            VerticalAlignment="Center" />
                                        <TextBlock
                                            Grid.Column="1"
                                            FontFamily="Cascadia Mono"
                                            Text="{Binding ProviderId}" />
                                    </Grid>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>

                        <StackPanel
                            Grid.Column="1"
                            Spacing="6">
                            <Button
                                Command="{Binding MoveSelectedProviderUpCommand}"
                                Content="Up"
                                Style="{StaticResource SubtleAction}" />
                            <Button
                                Command="{Binding MoveSelectedProviderDownCommand}"
                                Content="Down"
                                Style="{StaticResource SubtleAction}" />
                            <Button
                                Command="{Binding SelectAllProvidersCommand}"
                                Content="All"
                                Style="{StaticResource SubtleAction}" />
                            <Button
                                Command="{Binding ClearProviderSelectionCommand}"
                                Content="None"
                                Style="{StaticResource SubtleAction}" />
                        </StackPanel>
                    </Grid>
                </Grid>
            </Border>

            <Border
                Grid.Column="1"
                Style="{StaticResource PanelCardBorderStyle}">
                <Grid RowSpacing="8">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <TextBlock
                        Style="{StaticResource SectionTitleTextStyle}"
                        Text="Workflow Profile" />

                    <Grid
                        Grid.Row="1"
                        ColumnSpacing="8">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <ComboBox
                            Header="Source Language"
                            ItemsSource="{Binding AvailableLanguages}"
                            SelectedItem="{Binding SourceLanguage, Mode=TwoWay}" />
                        <ComboBox
                            Grid.Column="1"
                            Header="Target Language"
                            ItemsSource="{Binding AvailableLanguages}"
                            SelectedItem="{Binding TargetLanguage, Mode=TwoWay}" />
                    </Grid>

                    <Grid
                        Grid.Row="2"
                        ColumnSpacing="8">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <ToggleSwitch
                            Header="Load STRINGS"
                            IsOn="{Binding LoadStrings, Mode=TwoWay}" />
                        <ToggleSwitch
                            Grid.Column="1"
                            Header="Load Record Fields"
                            IsOn="{Binding LoadRecordFields, Mode=TwoWay}" />
                    </Grid>

                    <TextBox
                        Grid.Row="3"
                        Header="Current Workflow Chain"
                        IsReadOnly="True"
                        Text="{Binding ProviderChainPreview}" />

                    <StackPanel
                        Grid.Row="4"
                        Spacing="8">
                        <Button
                            Command="{Binding RunBatchTranslationCommand}"
                            Content="Run Workflow"
                            Style="{StaticResource PrimaryAction}" />
                        <TextBlock
                            Opacity="0.72"
                            Text="Tip: Enable/disable providers and reorder them to define fallback sequence. The first available provider runs first, failures fall through automatically." />
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>

        <Border
            Grid.Row="2"
            Style="{StaticResource PanelCardBorderStyle}"
            Padding="12,8">
            <TextBlock Text="{Binding StatusText}" />
        </Border>
    </Grid>
</Page>


